# ADR-0005: Puzzle First — структура директорий и единичный выбор паззла

## Контекст

Текущая кодовая база ориентировалась на один паззл (Sudoku 9x9), что приводило
к жёстко связанным путям (`src/sudoku_solver.py`, `src/sudoku_generator.py`) и
не позволялo масштабировать пайплайн на новые варианты. При параллельной
разработке Nova и наследия требовалось изолировать реализации и гарантировать,
что за один запуск пайплайна выбирается ровно один паззл, иначе появлялись
недетерминизм и смешение артефактов.

## Решение

- В корне `src` создано древо `puzzles/<puzzle_kind>/...` с каталогами по ролям
  (`solver`, `generator`, `printer`, `difficulty`), а также подпапками для
  `schemas`, `fixtures`, `benchmarks`, `adapters`, `tests`.
- Для Sudoku 9x9 добавлены алиасы `legacy` и `novus`, которые переэкспортируют
  существующие реализации без физического переноса исходников.
- Создан единый `ports/` слой и `orchestrator/router.py`, выбирающий реализацию
  по идентификаторам паззла и роли.
- Запуск пайплайна требует явного указания `puzzle_kind` через CLI флаг
  `--puzzle`, переменную окружения `PUZZLE_KIND` или `config.toml` (`[run]`).

## Последствия

- Структура «Puzzle First» позволяет параллельно развивать несколько видов
  паззлов без конфликтов в путях и импортов.
- Алиасы дают возможность отката (rollback): чтобы вернуться к старой схеме
  достаточно удалить новые каталоги и вызывать модули напрямую.
- Оркестратор получил детерминированный журнал выбора модулей, что облегчает
  наблюдаемость и аудит запусков.
- Любой новый паззл обязан зарегистрировать каталоги и записи в `config.toml`,
  иначе Router вернёт понятную ошибку при выборе реализации.
