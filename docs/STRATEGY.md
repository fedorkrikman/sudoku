**Кратко (RU):** Стратегия Sudoku фиксирует цели развития solver и диспетчера, а также инварианты детерминизма.
**Summary (EN):** The Sudoku strategy captures the solver roadmap, dispatcher determinism invariants, and supporting measurement plans.

# Стратегия Sudoku

Документ описывает ключевые цели владельца и базовые ограничения детерминизма, которыми руководствуется команда при развитии генератора и решателя Sudoku.

## Пять целей (owner)

1. Полный перенос логики на модульный solver (novus primary).

### 1.5 Инварианты детерминизма диспетчера

- Двухфазная схема: вычисление предложений (compute proposals) выполняется параллельно, фиксация (commit) строго по канону.
- Канон коммита: ELIM < PLACE → cell asc (0..80) → digit asc (1..9).
- Режим 1 поток — референс; при любом N>1 результат идентичен: CompleteGrid, SolveTrace и артефакты (JCS) совпадают; логи сравнимы после нормализации.
- Запрет параллелить шаги с зависимостями; спекулятивные результаты перепроверяются перед коммитом.
- Источники времени/рандома/локали не влияют на логику; такие поля исключены из сравнения.

<ol start="2">
<li>Многопоточность: модуль + диспетчер; при 1 потоке — последовательный проход; при N>1 — очереди и параллелизм допустимых приёмов.</li>
<li>Тестирование/метрики в два слоя: (a) продуктовые — ритм/кульминации, равномерность сложности, однозначность шагов, геометрическая красота; (b) техконтур — сид-дисциплина, воспроизводимость, NFR-профиль и данные для настройки параллелизма.</li>
<li>Один модифицированный «алгоритм-изюминка» для эстетики на medium.</li>
<li>Перенос на 16×16 с максимальным переиспользованием модулей и диспетчера.</li>
</ol>
# STRATEGY

> Verified on 2025-09-26

## Product thesis

Nova Solver становится основным путём генерации Sudoku-9×9 без регресса по
качеству и детерминизму. Мы разворачиваем новус параллельно с legacy до тех пор,
пока отчёты determinism/parity/NFR/shadow подтверждают готовность и устойчивые
метрики.

## Horizons

- **3 месяца** — production-readiness для sudoku-9×9: стабильные CI-гейты,
  закрытые технические долги и готовность переключить профиль `prod` на novus.
- **12 месяцев** — расширение кросс-пазлового портфеля (16×16, killer, вариации)
  с едиными контрактами и повторно используемыми стадиями.

## Goal stack

| Level | Dev profile | Prod profile |
| --- | --- | --- |
| Guardrail (эта итерация) | p95 ≤ 400 ms | p95 ≤ 300 ms |
| SLO (1–2 итерации) | p95 ≤ 250 ms | p95 ≤ 150 ms |
| North-Star (12 мес) | p95 ≤ 150 ms | p95 ≤ 75 ms |

## Principles

1. **Детерминизм как инвариант** — один сид ⇒ один набор артефактов, никакой
   недетерминированности в портах.
2. **JCS везде** — отчёты, артефакты и логи канонизируются по RFC 8785, чтобы
   гейты могли сравнивать побайтно.
3. **Без сетевых зависимостей** — CI и офлайн-скрипты не требуют сети, все
   данные либо в репозитории, либо в артефакт сторе.
4. **Паритет перед переключением** — переключение `prod` допускается только при
   выполненных гейтах determinism/parity/NFR/shadow.
5. **Документированность** — каждое изменение стратегии сопровождается записью в
   CHANGELOG и ссылкой на проверку.

## Risks and assumptions

- **Аппаратный дрейф**: латентность и RSS чувствительны к окружению. Контролим
  через фиксированные профили и baseline-отчёты.
- **Недостаточная выборка**: гейты работают на 500–1000 сидов; при расширении
  нужно масштабировать корпуса и следить за временем выполнения (≤ 15 мин).
- **Shadow overheard**: увеличение sample_rate без учёта overhead может ударить
  по latency. Используем `shadow_overhead_guard` для авто-регулировки.
- **Баланс сложностей**: acceptance-корпус сбалансирован 4:4:2, изменения только
  через v2 и ADR.

## Compatibility

- Форматы Envelope и ArtifactRef стабильны; несовместимые изменения требуют ADR
  и записи в `MIGRATIONS.md`.
- Отчёты `tools/ci` канонизированы и сравниваются побайтно, timestamp/uuid
  внутрь отчёта не записываем.
- Acceptance-корпус `acceptance_corpus_9x9_v1.json` immutable; любые обновления
  только через новую версию и совместное решение ARC+ALG+INT.
